---
import Layout from '../layouts/Layout.astro';
import { getEntry, getCollection, render } from 'astro:content';
import Search from '../components/Search.astro';

const researchPage = await getEntry('pages', 'research');

if (!researchPage) {
  throw new Error("Could not find 'research' page content");
}

const { Content } = await render(researchPage);
const { data } = researchPage;
const papers = await getCollection('research');
// Optional: sort papers if needed, but current data is string based. 
// Ideally change schema to date object for sorting, but for now simple reverse or keeping as is.
// papers.sort((a, b) => new Date(b.data.date).valueOf() - new Date(a.data.date).valueOf());

---

<Layout title="Research & Analysis | Ben Lovell">
  <main class="bg-canvas min-h-screen">
    <!-- Hero Section -->
    <div class="relative w-full h-[50vh] min-h-[400px] flex items-center justify-center overflow-hidden mb-16">
      <!-- Background Image -->
      <div 
        class="absolute inset-0 bg-cover bg-center bg-no-repeat"
        style="background-image: url('/images/lfrl.png');"
      >
        <!-- Overlay -->
        <div class="absolute inset-0 bg-charcoal/60 backdrop-blur-[2px]"></div>
      </div>

      <!-- Content -->
      <div class="relative z-10 text-center px-6 max-w-4xl mx-auto">
        <h1 class="text-5xl md:text-7xl font-bold text-white mb-6 border-b-2 border-adobe/50 pb-6 inline-block">
          Law Firm Research Lab
        </h1>
        <div class="text-xl md:text-2xl text-white/90 font-body leading-relaxed max-w-2xl mx-auto">
          <Content />
        </div>
      </div>
    </div>

    <div class="max-w-4xl mx-auto px-6 pb-20">
      <header class="mb-16 text-center">
        <Search />
      </header>

      <div class="grid md:grid-cols-2 gap-x-12 gap-y-16" data-pagefind-body>
        {papers.map((paper) => (
          <article class="group relative flex flex-col h-full border-b-2 border-charcoal/10 pb-4 hover:border-adobe transition-colors">
            <!-- Book Spine Visual Stub -->
            <div class="absolute -left-4 top-0 bottom-4 w-1 bg-gradient-to-b from-sage to-sky opacity-0 group-hover:opacity-100 transition-opacity rounded-sm"></div>
            
            <div class="flex-grow">
               <div class="mb-3 flex items-center justify-between text-sm">
                  <span class="font-bold text-adobe uppercase tracking-wider">{paper.data.type}</span>
                  <span class="text-charcoal/40 font-mono">{paper.data.date}</span>
               </div>
               <h2 class="text-2xl font-bold text-charcoal mb-4 group-hover:text-adobe transition-colors leading-tight">
                  <a href={paper.data.url || `/research/${paper.id}`} class="before:absolute before:inset-0">
                     {paper.data.title}
                  </a>
               </h2>
               <p class="text-charcoal/70 leading-relaxed">
                  {paper.data.summary}
               </p>
            </div>
          </article>
        ))}
      </div>
    </div>
  </main>
</Layout>
